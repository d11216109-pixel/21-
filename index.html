<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>21é»ï¼ˆBlackjackï¼‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            font-size: 1rem;
            color: #a8dadc;
        }

        .rules-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .rules-section h2 {
            margin-bottom: 15px;
            color: #f1faee;
        }

        .rules-section p {
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .game-table {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            min-height: 400px;
        }

        .player-area, .dealer-area {
            margin-bottom: 30px;
        }

        .area-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .score {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .cards {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 100px;
        }

        .card {
            width: 70px;
            height: 100px;
            background: white;
            color: black;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .card.hidden {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .card .rank {
            font-size: 1.2rem;
        }

        .card .suit {
            font-size: 1.8rem;
        }

        .card.red {
            color: #e63946;
        }

        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        button {
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #newGameBtn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        #hitBtn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        #standBtn {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .status-log {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            min-height: 100px;
            max-height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            border-left: 3px solid #4cc9f0;
        }

        .log-entry.win {
            border-left-color: #06ffa5;
        }

        .log-entry.lose {
            border-left-color: #ff006e;
        }

        .log-entry.push {
            border-left-color: #ffbe0b;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .card {
                width: 60px;
                height: 85px;
                font-size: 1.2rem;
            }

            .card .rank {
                font-size: 1rem;
            }

            .card .suit {
                font-size: 1.5rem;
            }

            button {
                padding: 12px 20px;
                font-size: 1rem;
            }
        }

        @media (max-width: 360px) {
            .card {
                width: 50px;
                height: 70px;
                font-size: 1rem;
            }

            .card .rank {
                font-size: 0.9rem;
            }

            .card .suit {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>21 é»ï¼ˆBlackjackï¼‰</h1>
            <p class="subtitle">å–®æª”ç¤ºç¯„ï¼šéš¨æ©ŸæŠ½ç‰Œ + ç°¡æ˜“è¦å‰‡</p>
        </header>

        <section class="rules-section">
            <h2>éŠæˆ²è¦å‰‡</h2>
            <p><strong>ç›®æ¨™ï¼š</strong>è®“æ‰‹ç‰Œé»æ•¸æ¥è¿‘ 21 é»ï¼Œä½†ä¸èƒ½è¶…é 21 é»ã€‚</p>
            <p><strong>é»æ•¸è¨ˆç®—ï¼š</strong>2-10 ç‚ºç‰Œé¢é»æ•¸ï¼ŒJ/Q/K ç‚º 10 é»ï¼ŒA å¯ä»¥ç®—ä½œ 1 é»æˆ– 11 é»ï¼ˆè‡ªå‹•é¸æ“‡æœ€ä½³å€¼ï¼‰ã€‚</p>
            <p><strong>ç©å®¶æ“ä½œï¼š</strong>Hitï¼ˆè¦ç‰Œï¼‰ç¹¼çºŒæŠ½ç‰Œï¼ŒStandï¼ˆåœç‰Œï¼‰åœæ­¢æŠ½ç‰Œé€²å…¥èŠå®¶å›åˆã€‚</p>
            <p><strong>èŠå®¶è¦å‰‡ï¼š</strong>èŠå®¶é»æ•¸å°æ–¼ 17 é»å¿…é ˆè£œç‰Œï¼Œé”åˆ° 17 é»æˆ–ä»¥ä¸Šå¿…é ˆåœç‰Œã€‚</p>
            <p><strong>å‹è² åˆ¤å®šï¼š</strong>ç©å®¶æˆ–èŠå®¶è¶…é 21 é»çˆ†ç‰Œå³è¼¸ï¼Œå¦å‰‡æ¯”é»æ•¸å¤§å°ï¼Œç›¸ç­‰å‰‡å¹³æ‰‹ï¼ˆPushï¼‰ã€‚</p>
            <p><em>è¨»ï¼šæœ¬ç‰ˆæœ¬ç‚ºç°¡åŒ–è¦å‰‡ï¼Œä¸åŒ…å«ä¸‹æ³¨ã€Doubleï¼ˆåŠ å€ï¼‰ã€Splitï¼ˆåˆ†ç‰Œï¼‰ã€Surrenderï¼ˆæŠ•é™ï¼‰ã€Blackjack ç‰¹æ®Šè³ ç‡ï¼ˆ3:2ï¼‰ç­‰é€²éšç©æ³•ã€‚</em></p>
        </section>

        <div class="game-table">
            <div class="dealer-area">
                <div class="area-title">
                    <span>èŠå®¶</span>
                    <span class="score" id="dealerScore">-</span>
                </div>
                <div class="cards" id="dealerCards"></div>
            </div>

            <div class="player-area">
                <div class="area-title">
                    <span>ç©å®¶</span>
                    <span class="score" id="playerScore">-</span>
                </div>
                <div class="cards" id="playerCards"></div>
            </div>
        </div>

        <div class="actions">
            <button id="newGameBtn">New Game</button>
            <button id="hitBtn" disabled>Hitï¼ˆè¦ç‰Œï¼‰</button>
            <button id="standBtn" disabled>Standï¼ˆåœç‰Œï¼‰</button>
        </div>

        <div class="status-log" id="statusLog">
            <div class="log-entry">æ­¡è¿ä¾†åˆ° 21 é»éŠæˆ²ï¼é»æ“Š New Game é–‹å§‹éŠæˆ²ã€‚</div>
        </div>
    </div>

    <script>
        // Constants
        const SUITS = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
        const RANKS = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        
        // Game states
        const STATE = {
            IDLE: 'IDLE',
            PLAYER_TURN: 'PLAYER_TURN',
            DEALER_TURN: 'DEALER_TURN',
            FINISHED: 'FINISHED'
        };

        // Game variables
        let deck = [];
        let playerHand = [];
        let dealerHand = [];
        let gameState = STATE.IDLE;
        let dealerHiddenCard = true;

        // DOM elements
        const newGameBtn = document.getElementById('newGameBtn');
        const hitBtn = document.getElementById('hitBtn');
        const standBtn = document.getElementById('standBtn');
        const playerCardsEl = document.getElementById('playerCards');
        const dealerCardsEl = document.getElementById('dealerCards');
        const playerScoreEl = document.getElementById('playerScore');
        const dealerScoreEl = document.getElementById('dealerScore');
        const statusLogEl = document.getElementById('statusLog');

        // Event listeners
        newGameBtn.addEventListener('click', startGame);
        hitBtn.addEventListener('click', onHit);
        standBtn.addEventListener('click', onStand);

        // Build a standard 52-card deck
        function buildDeck() {
            const newDeck = [];
            for (const suit of SUITS) {
                for (const rank of RANKS) {
                    newDeck.push({ suit, rank });
                }
            }
            return newDeck;
        }

        // Fisher-Yates shuffle algorithm
        function shuffle(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Draw a card from the deck
        function drawCard() {
            if (deck.length === 0) {
                log('ç‰Œçµ„å·²ç”¨å®Œï¼', 'error');
                return null;
            }
            return deck.pop();
        }

        // Calculate hand score with A=1/11 logic
        function calculateScore(hand) {
            let score = 0;
            let aces = 0;

            for (const card of hand) {
                if (card.rank === 'A') {
                    aces++;
                    score += 1;
                } else if (['J', 'Q', 'K'].includes(card.rank)) {
                    score += 10;
                } else {
                    score += parseInt(card.rank);
                }
            }

            // Try to use one Ace as 11 if it doesn't bust
            while (aces > 0 && score + 10 <= 21) {
                score += 10;
                aces--;
            }

            return score;
        }

        // Start a new game
        function startGame() {
            // Reset game state
            deck = shuffle(buildDeck());
            playerHand = [];
            dealerHand = [];
            gameState = STATE.PLAYER_TURN;
            dealerHiddenCard = true;

            // Clear log
            statusLogEl.innerHTML = '';
            log('æ–°éŠæˆ²é–‹å§‹ï¼ç™¼ç‰Œä¸­...');

            // Deal initial cards
            playerHand.push(drawCard());
            dealerHand.push(drawCard());
            playerHand.push(drawCard());
            dealerHand.push(drawCard());

            // Update UI
            renderHands();
            renderScores();
            updateButtons();

            const playerScore = calculateScore(playerHand);
            const dealerVisibleCard = dealerHand[0];
            log(`ç©å®¶ç²å¾— ${formatCard(playerHand[0])} å’Œ ${formatCard(playerHand[1])}ï¼Œé»æ•¸ç‚º ${playerScore}ã€‚`);
            log(`èŠå®¶æ˜ç‰Œç‚º ${formatCard(dealerVisibleCard)}ï¼Œå¦ä¸€å¼µè“‹ç‰Œã€‚`);
            log('è«‹é¸æ“‡ Hitï¼ˆè¦ç‰Œï¼‰æˆ– Standï¼ˆåœç‰Œï¼‰ã€‚');
        }

        // Player hits
        function onHit() {
            if (gameState !== STATE.PLAYER_TURN) return;

            const card = drawCard();
            if (!card) return;

            playerHand.push(card);
            const score = calculateScore(playerHand);

            log(`ä½ æŠ½åˆ° ${formatCard(card)}ï¼Œé»æ•¸è®Šæˆ ${score}ã€‚`);

            renderHands();
            renderScores();

            // Check for bust
            if (score > 21) {
                gameState = STATE.FINISHED;
                log('ä½ çˆ†ç‰Œäº†ï¼èŠå®¶ç²å‹ã€‚', 'lose');
                finishGame();
            }
        }

        // Player stands
        function onStand() {
            if (gameState !== STATE.PLAYER_TURN) return;

            gameState = STATE.DEALER_TURN;
            log('ä½ é¸æ“‡åœç‰Œã€‚');
            updateButtons();
            
            // Dealer's turn
            setTimeout(dealerPlay, 1000);
        }

        // Dealer's turn logic
        function dealerPlay() {
            dealerHiddenCard = false;
            renderHands();
            renderScores();

            const dealerScore = calculateScore(dealerHand);
            log(`èŠå®¶ç¿»é–‹è“‹ç‰Œï¼Œé»æ•¸ç‚º ${dealerScore}ã€‚`);

            dealerDrawCards();
        }

        function dealerDrawCards() {
            let dealerScore = calculateScore(dealerHand);

            if (dealerScore < 17) {
                setTimeout(() => {
                    const card = drawCard();
                    if (!card) {
                        finishGame();
                        return;
                    }

                    dealerHand.push(card);
                    dealerScore = calculateScore(dealerHand);

                    log(`èŠå®¶è£œç‰Œ ${formatCard(card)}ï¼Œé»æ•¸è®Šæˆ ${dealerScore}ã€‚`);
                    
                    renderHands();
                    renderScores();

                    if (dealerScore >= 17) {
                        setTimeout(() => {
                            gameState = STATE.FINISHED;
                            settle();
                        }, 1000);
                    } else {
                        dealerDrawCards();
                    }
                }, 1000);
            } else {
                setTimeout(() => {
                    log('èŠå®¶åœç‰Œã€‚');
                    gameState = STATE.FINISHED;
                    settle();
                }, 1000);
            }
        }

        // Settle the game
        function settle() {
            const playerScore = calculateScore(playerHand);
            const dealerScore = calculateScore(dealerHand);

            if (dealerScore > 21) {
                log(`çµç®—ï¼šèŠå®¶çˆ†ç‰Œï¼ˆ${dealerScore}ï¼‰ï¼Œä½ ç²å‹ï¼`, 'win');
            } else if (playerScore > dealerScore) {
                log(`çµç®—ï¼šä½  ${playerScore} vs èŠå®¶ ${dealerScore}ï¼Œä½ ç²å‹ï¼`, 'win');
            } else if (playerScore < dealerScore) {
                log(`çµç®—ï¼šä½  ${playerScore} vs èŠå®¶ ${dealerScore}ï¼Œä½ è¼¸äº†ã€‚`, 'lose');
            } else {
                log(`çµç®—ï¼šä½  ${playerScore} vs èŠå®¶ ${dealerScore}ï¼Œå¹³æ‰‹ï¼ˆPushï¼‰ã€‚`, 'push');
            }

            finishGame();
        }

        // Finish the game
        function finishGame() {
            gameState = STATE.FINISHED;
            updateButtons();
            log('éŠæˆ²çµæŸã€‚é»æ“Š New Game é–‹å§‹æ–°ä¸€å±€ã€‚');
        }

        // Render hands on UI
        function renderHands() {
            // Render player's cards
            playerCardsEl.innerHTML = '';
            for (const card of playerHand) {
                playerCardsEl.appendChild(createCardElement(card));
            }

            // Render dealer's cards
            dealerCardsEl.innerHTML = '';
            for (let i = 0; i < dealerHand.length; i++) {
                if (i === 1 && dealerHiddenCard) {
                    dealerCardsEl.appendChild(createHiddenCardElement());
                } else {
                    dealerCardsEl.appendChild(createCardElement(dealerHand[i]));
                }
            }
        }

        // Create card element
        function createCardElement(card) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card';
            
            if (card.suit === 'â™¥' || card.suit === 'â™¦') {
                cardDiv.classList.add('red');
            }

            const rankSpan = document.createElement('div');
            rankSpan.className = 'rank';
            rankSpan.textContent = card.rank;

            const suitSpan = document.createElement('div');
            suitSpan.className = 'suit';
            suitSpan.textContent = card.suit;

            cardDiv.appendChild(rankSpan);
            cardDiv.appendChild(suitSpan);

            return cardDiv;
        }

        // Create hidden card element
        function createHiddenCardElement() {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card hidden';
            cardDiv.textContent = 'ğŸ‚ ';
            return cardDiv;
        }

        // Render scores
        function renderScores() {
            const playerScore = calculateScore(playerHand);
            playerScoreEl.textContent = playerHand.length > 0 ? playerScore : '-';

            if (dealerHand.length === 0) {
                dealerScoreEl.textContent = '-';
            } else if (dealerHiddenCard) {
                // Show only the visible card's score
                const visibleScore = calculateScore([dealerHand[0]]);
                dealerScoreEl.textContent = `${visibleScore}+?`;
            } else {
                dealerScoreEl.textContent = calculateScore(dealerHand);
            }
        }

        // Update button states
        function updateButtons() {
            hitBtn.disabled = gameState !== STATE.PLAYER_TURN;
            standBtn.disabled = gameState !== STATE.PLAYER_TURN;
        }

        // Format card for display in log
        function formatCard(card) {
            return `${card.suit}${card.rank}`;
        }

        // Log message to status area
        function log(message, type = '') {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            if (type) {
                logEntry.classList.add(type);
            }
            
            logEntry.textContent = message;
            statusLogEl.appendChild(logEntry);
            
            // Auto-scroll to bottom
            statusLogEl.scrollTop = statusLogEl.scrollHeight;
        }
    </script>
</body>
</html>
